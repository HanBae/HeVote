extends ../base/layout

block content
    .container
        if (!voteDetail)
            p 해당 주소의 투표가 존재하지 않습니다!
        else
            -startVoteDate = new Date(voteDetail.summary[3] * 1000).toLocaleString();
            -endVoteDate = new Date(voteDetail.summary[4] * 1000).toLocaleString();
            h1.display-4 #{voteDetail.summary[0]}
            if (voteDetail.summary[5])
                small (인원이 한정된 투표)
            h5.my-1 상태:
                case voteDetail.summary[2]
                    when '0': b.text-muted 대기
                    when '1': b.text-primary 진행 중
                    when '2': b.text-success 일시중지
                    when '3': b.text-danger 종료
                    default: b.text-danger 오류
            p.lead #{voteDetail.summary[1]}
                br
                | 기간 : #{startVoteDate} ~ #{endVoteDate}
            if(voteDetail.summary[2] !== '0')
                h4 총 투표자 수 : #{voteDetail.voterNumber}
            hr.my-4
            if(voteDetail.resultName)
                h1.text-center
                    b #{voteDetail.resultName.join(',')}
                    | 님이 당선되셨습니다!
            h3 후보자 목록
            p
                -val = 1
                .card-deck
                    each candidate in voteDetail.candidateList
                        .card(style='width: 15rem;')
                            .card-body
                                h5.card-title
                                    b #{val}
                                    | #{": " + candidate[0]}
                                p.card-text
                                    | 득표수 : #{candidate[2]}
                                if(candidate[1].includes("http"))
                                    -onClick = "window.open('" + candidate[1] + "')"
                                    button.btn.btn-success(onclick=onClick) 공약보기
                                else
                                    button.btn.btn-primary(type='button', data-toggle='modal', data-target='#commitmentModal')
                                        | 공약보기
                                    // Modal
                                    #commitmentModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='modalCenterTitle', aria-hidden='true')
                                        .modal-dialog.modal-dialog-centered(role='document')
                                            .modal-content
                                                .modal-header
                                                    h5#modalLongTitle.modal-title #{candidate[0]}의 공약
                                                    button.close(type='button', data-dismiss='modal', aria-label='Close')
                                                        span(aria-hidden='true') ×
                                                .modal-body
                                                    | #{candidate[1]}
                                                .modal-footer
                                                    button.btn.btn-secondary(type='button', data-dismiss='modal') 닫기

                        -val += 1
            if(user && !voteDetail.owner)
                if(voteDetail.voterState !== '2')
                    .text-center
                        -voteInPath = path + '/vote'
                        -voteButtonDisabled = voteDetail.summary[2] !== '1'
                        a.btn.btn-primary.btn-lg.active(
                            href=voteInPath
                            role="button"
                            aria-pressed="true"
                            disabled=voteButtonDisabled
                        ) 투표참여
                else
                    .text-center
                        button.btn.btn-primary.btn-lg.active(
                        role="button"
                        aria-pressed="true"
                        disabled
                        ) 이미 투표에 참여하셨습니다!
            if(voteDetail.owner)
                button.btn.btn-default(
                    data-target='#modifyForm'
                    data-toggle='collapse'
                    aria-expanded="false"
                    aria-controls="modifyForm") 투표 정보 수정하기
                #modifyForm.collapse(style='margin: 30px;')
                    form(role='form', action=path, method="post", style='max-width: 300px;')
                        .form-group
                            label(for='voteState') 투표 상태 변경
                            #voteState.btn-group.btn-group-toggle(data-toggle='buttons')
                                label.btn.btn-secondary
                                    input#option1(type='radio', name='state', value='0' autocomplete='off')
                                    |  대기
                                label.btn.btn-primary
                                    input#option2(type='radio', name='state', value='1' autocomplete='off')
                                    |  진행 중
                                label.btn.btn-success
                                    input#option3(type='radio', name='state', value='2' autocomplete='off')
                                    |  일시중지
                                label.btn.btn-danger
                                    input#option4(type='radio', name='state', value='3' autocomplete='off')
                                    |  종료
                        button.btn.btn-default(type='submit') 바꾸기
                    br
                    br
                    form(role='form', action=path+'/modify', method="post", style='max-width: 300px;')
                        fieldset(disabled)
                            .form-group
                                label(for='voteTitle') 투표 제목(변경 불가)
                                input#voteTitle.form-control(type='text', placeholder=voteDetail.summary[0])
                        .form-group
                            label(for='voteDescription') 투표 설명
                            textarea#voteDescription.form-control(rows='3' name='voteDescription') #{voteDetail.summary[1]}
                        .form-group
                            span
                                label(for='startDateTimePicker') 투표 시작 날짜
                                input#startDateTimePicker(width='312' name='startDate' value=startVoteDate)
                                br
                                label(for='endDateTimePicker') 투표 종료 날짜
                                input#endDateTimePicker(width='312' name='endDate' value=endVoteDate)
                            script.
                                $('#startDateTimePicker').datetimepicker({
                                    uiLibrary: 'bootstrap4',
                                    format: 'yyyy-m-dd HH:MM'
                                });
                                $('#endDateTimePicker').datetimepicker({
                                    uiLibrary: 'bootstrap4',
                                    format: 'yyyy-m-dd HH:MM'
                                });
                        button.btn.btn-default(type='submit') 정보 변경